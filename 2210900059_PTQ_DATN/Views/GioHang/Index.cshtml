@using _2210900059_PTQ_DATN.Models.ViewModels
@model List<GioHangItemVM>

@{
    ViewData["Title"] = "Giỏ hàng";
}

<link rel="stylesheet" href="~/css/giohang.css" />

<section class="section">
    <div class="container">
        <h2 class="section-title">Giỏ hàng</h2>

        @if (!Model.Any())
        {
            <div class="empty-cart">
                <p>Giỏ hàng của bạn đang trống.</p>
                <a href="@Url.Action("Index", "Home")" class="btn-outline">
                    ← Quay lại trang chủ
                </a>
            </div>
        }
        else
        {
            <div class="cart-layout">

                <!-- LEFT -->
                <div class="cart-left">
                    <div class="cart-wrapper">
                        <table class="cart-table">
                            <thead>
                                <tr>
                                    <th>Hình</th>
                                    <th>Tên</th>
                                    <th>Loại</th>
                                    <th>Đơn giá</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td data-label="Hình">
                                            <img src="@(Url.Content(item.LoaiItem == "SP"
                                             ? "~/images/products/" + item.HinhAnh
                                             : "~/images/services/" + item.HinhAnh))" />
                                </td>

                                        <td data-label="Tên">
                                            <div class="cart-name">@item.Ten</div>
                                            <div class="cart-type">
                                                @(item.LoaiItem == "SP" ? "Sản phẩm" : "Dịch vụ")
                                            </div>
                                        </td>

                                        <td data-label="Loại">
                                            @(item.LoaiItem == "SP" ? "Sản phẩm" : "Dịch vụ")
                                        </td>

                                        <td data-label="Đơn giá" class="price">
                                            @item.DonGia.ToString("N0") đ
                                        </td>

                                        <td data-label="Số lượng">
                                            <div class="qty-control">
                                                <!-- GIẢM -->
                                                <a class="qty-btn"
                                                   href="@Url.Action("CapNhatSoLuong", "GioHang", new {
                                                        loai = item.LoaiItem,
                                                        id = item.MaCt,
                                                        soLuong = item.SoLuong - 1
                                                   })">−</a>

                                                <span class="qty-number">@item.SoLuong</span>

                                                <!-- TĂNG -->
                                                <a class="qty-btn"
                                                   href="@Url.Action("CapNhatSoLuong", "GioHang", new {
                                                        loai = item.LoaiItem,
                                                        id = item.MaCt,
                                                        soLuong = item.SoLuong + 1
                                                   })">+</a>
                                            </div>
                                        </td>

                                        <td data-label="Thành tiền" class="total">
                                            @((item.DonGia * item.SoLuong).ToString("N0")) đ
                                        </td>

                                        <!-- XÓA ITEM -->
                                        <td data-label="Xóa">
                                            <form asp-action="XoaItem"
                                                  asp-controller="GioHang"
                                                  method="post"
                                                  onsubmit="return confirm('Bạn có chắc muốn xóa sản phẩm này?');">
                                                <input type="hidden" name="maCt" value="@item.MaCt" />
                                                <button type="submit" class="btn-remove">
                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                         width="14"
                                                         height="14"
                                                         viewBox="0 0 24 24"
                                                         fill="none"
                                                         stroke="currentColor"
                                                         stroke-width="2"
                                                         stroke-linecap="round"
                                                         stroke-linejoin="round">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
                                                        <path d="M10 11v6"></path>
                                                        <path d="M14 11v6"></path>
                                                        <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
                                                    </svg>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                                        }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- RIGHT -->
                <div class="cart-right">
                    <div class="cart-summary">
                        <h3>Tóm tắt đơn hàng</h3>

                        <div class="summary-row">
                            <span>Tạm tính</span>
                            <strong>
                                @Model.Sum(x => x.DonGia * x.SoLuong).ToString("N0") đ
                            </strong>
                        </div>

                        <div class="summary-row">
                            <span>Vận chuyển</span>
                            <strong>Miễn phí</strong>
                        </div>

                        <hr />

                        <div class="summary-total">
                            <span>Tổng</span>
                            <strong>
                                @Model.Sum(x => x.DonGia * x.SoLuong).ToString("N0") đ
                            </strong>
                        </div>

                        <a href="@Url.Action("Index", "ThanhToan")" class="btn-checkout">
                            Tiến hành thanh toán
                        </a>

                        <a href="@Url.Action("Index", "Home")"
                           class="btn-outline btn-back">
                            ← Tiếp tục mua sắm
                        </a>
                    </div>
                </div>

            </div>
        }
    </div>
</section>